---
title: "The Ghost Endpoint (404 & 400)"
date: "2026-02-11"
description: "API 문 앞에서 '열려라 참깨'만 100번 외친 사연. (feat. Cloud Code API)"
tags: ["Error"]
logId: "ERR-003"
---

![Cover](/d9log/images/2026-02-11-ghost-endpoint.jpg)

## 👻 404 Not Found의 공포

어제 개발 중 겪은 에러 로그를 보면 아직도 등골이 서늘하다.<br/>
분명 서버는 살아있는데(`ping` 됨), 문을 안 열어준다.

```
[Antigravity] Probing endpoint: https://cloudcode-pa.googleapis.com/v1internal:chat
[Antigravity] Failed: 404 Not Found
```

`:chat`이 아니면 뭐지?<br/>
`:generateContent`? `:streamGenerateContent`? `:completion`?<br/>
다 찔러봤다. 결과는 **400 Bad Request** 아니면 **404**.

### 🧩 400 Bad Request: 희망고문

404는 "그런 거 없다"니까 포기하면 되는데, **400**은 사람을 미치게 한다.<br/>
**"있긴 있는데, 니가 보낸 데이터가 맘에 안 들어."**

```json
{
  "error": {
    "code": 400,
    "message": "Invalid JSON payload received. Unknown name \"contents\": Cannot find field."
  }
}
```

아니, Gemini 표준 필드가 `contents`인데 그걸 모른다고?<br/>
그럼 `messages`? `prompt`? `query`?<br/>
마치 비밀번호 4자리를 맞추는 도둑이 된 기분으로 Payload를 계속 바꿔가며 던졌다.

### 🕵️‍♂️ 원인은 gRPC Transcoding

나중에 알게 된 사실이지만, 구글 내부 API들은 대부분 **gRPC** 기반이고,<br/>
우리가 쓰는 HTTP REST API는 그걸 변환(Transcoding)해주는 게이트웨이다.

이 변환 규칙이 엄격해서, 필드명 하나라도 틀리면 가차 없이 400을 뱉는다.<br/>
게다가 `Cloud Code` API는 IDE 메타데이터(`ideType`, `project` 등)를 아주 까다롭게 요구했다.

### 🔧 해결: 표준으로의 회귀

결국 우리는 **"표준의 힘"**을 빌리기로 했다.<br/>
비공개 내부 API를 억지로 뚫는 것보다, **`gemini-cli`가 사용하는 공식 경로(또는 그에 준하는 안정적인 경로)**를 타는 것.<br/>
물론 그 과정에서 `node not found` 같은 자질구레한 환경 이슈도 있었지만, 그건 애교 수준.

**에러는 나침반이다.**<br/>
404가 뜨면 길을 바꾸고, 400이 뜨면 보따리(Payload)를 고쳐라.<br/>
그리고 500이 뜨면... 그건 내 탓 아님. (서버 탓임)
